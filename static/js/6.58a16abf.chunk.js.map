{"version":3,"sources":["services/github.js","routes/RepoInfo/index.js","routes/RepoInfo/index.module.less"],"names":["_getIssues","_asyncToGenerator","regenerator_default","a","mark","_callee","repo","wrap","_context","prev","next","abrupt","Object","request","replace","stop","this","_getUserInfo","_callee2","_context2","_ref","owner","github","getRepoInfo","RepoInfo_RepoInfo","RepoInfo","props","_this","_classCallCheck","_getPrototypeOf","call","state","loading","list","user","undefined","onRefresh","bind","_assertThisInitialized","subscribe","unsubscribe","setState","services_github","match","params","data","info","dispatch","type","payload","repos","findIndex","it","_this$state","subscribed","isSubscribed","react_default","createElement","Fragment","PageHeader_default","logo","alt","src","avatarUrl","title","href","concat","target","content","name","bio","action","className","index_module_default","button_default","disabled","onClick","breadcrumbList","PageBody","card_default","bordered","Issues","PureComponent","__webpack_exports__","dva","app","module","exports","italic","ellipsis","ponter"],"mappings":"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","file":"static/js/6.58a16abf.chunk.js","sourcesContent":["import request from '../utils/request';\r\nimport github from '../utils/github';\r\n\r\n\r\nexport default {\r\n  async getIssues(repo) {\r\n    return request(repo.replace(/https:\\/\\/github.com\\/(\\w+)\\/(\\w+)(\\/.*)?/, 'https://api.github.com/repos/$1/$2/issues'));\r\n    // return jwt.init({ login: login_v1 });\r\n  },\r\n  async getUserInfo(repo) {\r\n    return request(repo.replace(/https:\\/\\/github.com\\/(\\w+)(\\/.*)?/, 'https://api.github.com/users/$1'));\r\n    // return jwt.init({ login: login_v1 });\r\n  },\r\n  getRepoInfo({ owner, repo }) {\r\n    return github.getRepoInfo({ owner, repo });\r\n  },\r\n};\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'dva';\r\nimport { Button, Card } from 'antd';\r\nimport PageHeader from 'ant-design-pro/lib/PageHeader';\r\nimport PageBody from '../../components/PageBody';\r\nimport Issues from '../../components/Issues';\r\nimport githubService from '../../services/github';\r\nimport styles from './index.module.less';\r\n\r\nclass RepoInfo extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      loading: false,\r\n      list: [],\r\n      user: undefined,\r\n      // total: undefined,\r\n    };\r\n    this.onRefresh = this.onRefresh.bind(this);\r\n    this.subscribe = this.subscribe.bind(this);\r\n    this.unsubscribe = this.unsubscribe.bind(this);\r\n  }\r\n  componentDidMount() {\r\n    this.onRefresh();\r\n  }\r\n  componentWillUnmount() {\r\n    this.setState({ loading: false, list: [] });\r\n  }\r\n  async onRefresh() {\r\n    if (this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: true, list: [] });\r\n    const { data } = await githubService.getRepoInfo({\r\n      owner: this.props.match.params.owner,\r\n      repo: this.props.match.params.repo,\r\n    });\r\n    if (true !== this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: false, list: data && data.list, user: data && data.user });\r\n  }\r\n  updateIssue(info) {\r\n    // debugger;\r\n    // this.props.dispatch({ type: 'all/updateIssue', payload: info });\r\n  }\r\n  async subscribe() {\r\n    if (this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: true });\r\n    await this.props.dispatch({\r\n      type: 'app/subscribe',\r\n      payload: {\r\n        owner: this.props.match.params.owner,\r\n        repo: this.props.match.params.repo,\r\n      },\r\n    });\r\n    if (true !== this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: false });\r\n  }\r\n  async unsubscribe() {\r\n    if (this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: true });\r\n    await this.props.dispatch({\r\n      type: 'app/unsubscribe',\r\n      payload: {\r\n        owner: this.props.match.params.owner,\r\n        repo: this.props.match.params.repo,\r\n      },\r\n    });\r\n    if (true !== this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: false });\r\n  }\r\n  isSubscribed() {\r\n    if (!this.props.repos) {\r\n      return false;\r\n    }\r\n    const params = this.props.match.params;\r\n    const index = this.props.repos.findIndex(it => it.owner === params.owner && it.repo === params.repo);\r\n    return (-1 !== index);\r\n  }\r\n  render() {\r\n    const { user, list } = this.state;\r\n    const subscribed = this.isSubscribed();\r\n    return (\r\n      <React.Fragment>\r\n        <PageHeader\r\n          logo={user && <img alt=\"\" src={user.avatarUrl} />}\r\n          title={<a href={`https://github.com/${this.props.match.params.owner}/${this.props.match.params.repo}`} target=\"_blank\">\r\n            {this.props.match.params.owner}/{this.props.match.params.repo}\r\n          </a>}\r\n          content={user && <div>\r\n            <div>{user.name}</div>\r\n            <div>{user.bio}</div>\r\n          </div>}\r\n          action={<div className={styles.title}>\r\n            {(!subscribed) && <Button disabled={this.state.loading} type=\"primary\" onClick={this.subscribe}>订阅</Button>}\r\n            {subscribed && <Button disabled={this.state.loading} type=\"danger\" onClick={this.unsubscribe}>退订</Button>}\r\n            <Button disabled={this.state.loading} onClick={this.onRefresh}>刷新</Button>\r\n          </div>}\r\n          breadcrumbList={[{ title: null }]}\r\n        />\r\n        <PageBody>\r\n          <Card bordered={false}>\r\n            <Issues list={list} loading={this.state.loading} />\r\n          </Card>\r\n        </PageBody>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nRepoInfo.propTypes = {\r\n  repos: PropTypes.array,\r\n};\r\n\r\nexport default connect(state => ({\r\n  repos: state.app.repos,\r\n}))(RepoInfo);\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"italic\":\"index_italic__2CVuJ\",\"ellipsis\":\"index_ellipsis__2-cf5\",\"ponter\":\"index_ponter__1ObD3\",\"title\":\"index_title__11S5W\"};"],"sourceRoot":""}