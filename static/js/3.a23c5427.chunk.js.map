{"version":3,"sources":["models/watching.js"],"names":["__webpack_exports__","namespace","state","list","loading","subscriptions","setup","_ref","dispatch","history","listen","_ref2","pathname","search","type","payload","effects","load","_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_ref3","_ref4","call","put","select","_ref5","_ref6","data","_ref7","repos","wrap","_context","prev","next","watching","sent","abrupt","undefined","_services_user__WEBPACK_IMPORTED_MODULE_1__","getWatching","app","map","it","index","findIndex","item","repo","owner","_objectSpread","watch","stop","this","subscribe","_ref8","_ref9","result","_context2","resolve","unsubscribe","_ref10","_ref11","_context3","update","_ref12","_ref13","_ref14","newList","_context4","_toConsumableArray","reducers","save","action"],"mappings":"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","file":"static/js/3.a23c5427.chunk.js","sourcesContent":["// import React from 'react';\r\n// import { routerRedux } from 'dva/router';\r\n// import queryString from 'query-string';\r\n// import { notification } from 'antd';\r\n\r\nimport userServices from '../services/user';\r\n\r\n\r\nexport default {\r\n\r\n  namespace: 'watching',\r\n\r\n  state: {\r\n    list: [],\r\n    loading: false,\r\n  },\r\n\r\n  subscriptions: {\r\n    setup({ dispatch, history }) {\r\n      return history.listen(({ pathname, search }) => {\r\n        if ('/user/watching' === pathname) {\r\n          return dispatch({ type: 'load', payload: { search } });\r\n        }\r\n      });\r\n    },\r\n  },\r\n\r\n  effects: {\r\n    *load({ payload }, { call, put, select }) {  // eslint-disable-line\r\n      const { loading } = yield select(state => state.watching);\r\n      if (loading) {\r\n        return;\r\n      }\r\n      yield put({ type: 'save', payload: { list: undefined, loading: true } });\r\n      const { data } = yield call(userServices.getWatching);\r\n      yield put({ type: 'save', payload: { loading: false } });\r\n      if (!data) {\r\n        return yield put({ type: 'save', payload: { list: null } });\r\n      }\r\n      const { repos } = yield select(state => state.app);\r\n      const list = data.list.map((it) => {\r\n        const index = repos.findIndex((item) => {\r\n          return it.repo === item.repo && it.owner === item.owner;\r\n        });\r\n        return { ...it, watch: -1 !== index };\r\n      });\r\n      return yield put({ type: 'save', payload: { list } });\r\n    },\r\n    // *getOwners({ payload }, { put, call }) {},\r\n    *subscribe({ payload }, { put, call }) {\r\n      if (payload.loading) {\r\n        return;\r\n      }\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: true } });\r\n      const result = yield put.resolve({ type: 'app/subscribe', payload });\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: false, watch: result } });\r\n    },\r\n    *unsubscribe({ payload }, { put, call }) {\r\n      if (payload.loading) {\r\n        return;\r\n      }\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: true } });\r\n      const result = yield put.resolve({ type: 'app/unsubscribe', payload });\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: false, watch: !result } });\r\n    },\r\n    *update({ payload }, { put, select }) {\r\n      const { list } = yield select(state => state.watching);\r\n      if (!list) {\r\n        return;\r\n      }\r\n      const index = list.findIndex(it => (payload.owner === it.owner && payload.repo === it.repo));\r\n      if (-1 === index) {\r\n        return;\r\n      }\r\n      const newList = [...list];\r\n      newList[index] = { ...newList[index], ...payload };\r\n      yield put({ type: 'save', payload: { list: newList } });\r\n    },\r\n  },\r\n\r\n  reducers: {\r\n    save(state, action) {\r\n      return { ...state, ...action.payload };\r\n    },\r\n  },\r\n\r\n};\r\n"],"sourceRoot":""}