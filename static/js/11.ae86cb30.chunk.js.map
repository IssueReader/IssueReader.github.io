{"version":3,"sources":["models/all.js"],"names":["__webpack_exports__","namespace","state","list","loading","total","undefined","page","pageSize","subscriptions","setup","_ref","dispatch","history","listen","_ref2","pathname","search","type","payload","effects","load","_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_ref3","_ref4","call","put","select","parsed","_ref5","_ref6","data","wrap","_context","prev","next","query_string__WEBPACK_IMPORTED_MODULE_1___default","parse","parseInt","all","sent","abrupt","_services_localForage__WEBPACK_IMPORTED_MODULE_2__","getIssues","stop","this","subscribe","_ref7","_ref8","result","_context2","resolve","watch","unsubscribe","_ref9","_ref10","_context3","update","_ref11","_ref12","_ref13","index","newList","_context4","watching","findIndex","it","owner","repo","_toConsumableArray","_objectSpread","updateIssue","_ref14","_ref15","_ref16","issues","_context5","number","reducers","save","action"],"mappings":"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","file":"static/js/11.ae86cb30.chunk.js","sourcesContent":["// import React from 'react';\r\n// import { routerRedux } from 'dva/router';\r\n// import queryString from 'query-string';\r\n// import { notification } from 'antd';\r\nimport queryString from 'query-string';\r\nimport localForageService from '../services/localForage';\r\n// import userServices from '../services/user';\r\n\r\n\r\nexport default {\r\n\r\n  namespace: 'all',\r\n\r\n  state: {\r\n    list: [],\r\n    loading: false,\r\n    total: undefined,\r\n    page: 1,\r\n    pageSize: 20,\r\n  },\r\n\r\n  subscriptions: {\r\n    setup({ dispatch, history }) {\r\n      return history.listen(({ pathname, search }) => {\r\n        if ('/all' === pathname) {\r\n          return dispatch({ type: 'load', payload: { search } });\r\n        }\r\n      });\r\n    },\r\n  },\r\n\r\n  effects: {\r\n    *load({ payload }, { call, put, select }) {\r\n      const parsed = queryString.parse(payload.search);\r\n      const page = parseInt(parsed.page || 1, 10);\r\n      const { pageSize, loading } = yield select(state => state.all);\r\n      if (loading) {\r\n        return;\r\n      }\r\n      yield put({ type: 'save', payload: { list: [], loading: true, page } });\r\n      const { data } = yield call(localForageService.getIssues, (page - 1) * pageSize, pageSize);\r\n      yield put({ type: 'save', payload: { loading: false, list: (data && data.list) || null, total: data && data.total } });\r\n    },\r\n    // *getOwners({ payload }, { put, call }) {},\r\n    *subscribe({ payload }, { put, call }) {\r\n      if (payload.loading) {\r\n        return;\r\n      }\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: true } });\r\n      const result = yield put.resolve({ type: 'app/subscribe', payload });\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: false, watch: result } });\r\n    },\r\n    *unsubscribe({ payload }, { put, call }) {\r\n      if (payload.loading) {\r\n        return;\r\n      }\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: true } });\r\n      const result = yield put.resolve({ type: 'app/unsubscribe', payload });\r\n      yield put.resolve({ type: 'update', payload: { ...payload, loading: false, watch: !result } });\r\n    },\r\n    *update({ payload }, { put, select }) {\r\n      const { list } = yield select(state => state.watching);\r\n      if (!list) {\r\n        return;\r\n      }\r\n      const index = list.findIndex(it => (payload.owner === it.owner && payload.repo === it.repo));\r\n      if (-1 === index) {\r\n        return;\r\n      }\r\n      const newList = [...list];\r\n      newList[index] = { ...newList[index], ...payload };\r\n      yield put({ type: 'save', payload: { list: newList } });\r\n    },\r\n    *updateIssue({ payload }, { put, call, select }) {  // eslint-disable-line\r\n      yield call(localForageService.updateIssue, payload);\r\n      const { list } = yield select(state => state.all);\r\n      const index = list.findIndex(it => it.owner === payload.owner && it.repo === payload.repo && it.number === payload.number);\r\n      if (-1 !== index) {\r\n        const issues = [...list];\r\n        issues[index] = { ...issues[index], ...payload };\r\n        yield put({ type: 'save', payload: { list: issues } });\r\n      }\r\n    },\r\n  },\r\n\r\n  reducers: {\r\n    save(state, action) {\r\n      return { ...state, ...action.payload };\r\n    },\r\n  },\r\n\r\n};\r\n"],"sourceRoot":""}